/*
 * This defines a custom widget which displays number of words and characters in a current text note.
 * To be activated for a given note, add label 'wordCount' to the note, you can also make it inheritable and thus activate it for the whole subtree.
 * 
 * See it in action in "Books" and its subtree.
 */
const TPL = `
<div style="padding: 10px; border-top: 1px solid var(--main-border-color); contain: none;>
    <script src="http://127.0.0.1:37840/custom/synth/synth-preset-handler.js"></script>
    <synth-preset-handler></synth-preset-handler>
</div>`;

class NeutronPresetWidget extends api.NoteContextAwareWidget 
{
    static get parentWidget() { return 'center-pane'; }

    // get position() { return 100; } // higher value means position towards the bottom/right
    get position() { return 50; } // higher value means position towards the bottom/right

    isEnabled() 
    {       
        return super.isEnabled()  && this.note.hasLabel('neutronPresetWidget')
            && (
            ((this.note.type === 'text' || this.note.type === 'book')) || (this.note.type === 'file' && this.note.mime === "application/json"));
    }

    doRender() 
    {
        this.$widget = $(TPL);
        this.$neutronPresetHandler = this.$widget.find('synth-preset-handler');
        return this.$widget;
    }

    async refreshWithNote(note) 
    {
        const {content} = await note.getNoteComplement();
        this.$neutronPresetHandler[0].initSynth();
    }
}

module.exports = NeutronPresetWidget;